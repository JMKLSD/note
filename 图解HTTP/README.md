# 图解http
## 第一章
1. 计算机与网络设备要相互通信，双方就必须基于相同的方法。不同的硬件、操作系统之间的通信，所有的这一切都需要一种规则。我们就把这种规则称为协议`protocol`
2. 像这样把与互联网关联的协议集合起来总称为`TCP/IP`。也有说法认为，`TCP/IP`是指`TCP`和`IP`这两种协议。还有一种说法认为，`TCP/IP`是在`IP`协议的通信过程中，使用到的协议族的统称。
3. `TCP/IP`协议族里重要的一点就是分层。`TCP/IP`协议族按层次分别分为以下4层：应用层、传输层、网络层和数据链路层。
4. 把`TCP/IP`层次化是有好处的。比如，**如果互联网只由一个协议统筹，某个地方需要改变设计时，就必须把所有部分整体替换掉。而分层之后只需把变动的层替换掉即可**。把各层之间的接口部分规划好之后，每个层次内部的设计就能够自由改动了。（**这段同写代码一样**）
5. **层次化之后，设计也变得相对简单了。处于应用层上的应用可以只考虑分派给自己的任务，而不需要弄清对方在地球上哪个地方、对方的传输路线是怎样的、是否能够确保传输送达等问题。**（**这段同MV\*模式**）
6. TCP/IP协议族各层的作用：
- 应用层
    - 应用层决定了向用户提供应用服务时通信的活动。如FTP、DNS等。**HTTP协议也处于该层。**
- 传输层
    - 传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输。*TCP*
- 网络层
    - 网络层用来处理在网络上流动的数据包。该层规定了通过怎样的路径到达对方计算机，并把数据包传送给对方。 与对方计算机之间通过多台计算机或网络设备传输时，网络层提供的作用就是在众多的选项内提供一条传输路线。**IP**
- 链路层
    - 用来处理连接网络的硬件部分。**网络**
7. 发送端在层与层传送数据时，会被打上该层所属的首部信息。接收端在层与层之间会把对应的首部消去。这种把数据信息包装起来的做法称为封装。
8. TCP协议采用了三次握手策略。发送端首先发送一个带有SYN标志的数据包给对方，接收端收到后，回传一个SYN/ACK标志的数据包以示传达确认信息。最后发送端再回传一个带ACK标志的数据包，代表握手结束。
9. **DNS（Domain Name System）提供域名到IP地址之间的解析服务。**
一般用户都是通过域名来访问的，而不是通过IP地址来访问，因为记住一串数字比较难。但是让计算机去理解名称就比较困难了，所以DNS服务应运而生。通过域名来查找地址，然后反馈一个IP地址。
    - 发送端输入网址
    - DNS返回一个IP地址
    - 发送端用IP地址来进行访问。
10. URI（统一资源标识符）；URL（统一资源定位符）；URI用字符串标识某一互联网资源；URL表示资源的地点；URL是URI的子集；

## 第二章
1. HTTP协议用于客户端和服务端之间的通信
2. 方法：
- GET，获取资源，get方法用来请求访问已被uri识别的资源。
- POST，传输实体主题。
- PUT，用来传输文件，要求在请求报文的主体中包含文件内容，然后保存到请求URI指定的位置。由于put方法本身不带验证机制，任何人都能够上传文件，存在安全问题，因此一般的web网站不适用该方法。
- HEAD：获得报文首部（跟GET一样，只是不返回报文主体部分）
- DELETE：删除文件（是与PUT相反的方法）
- OPTIONS：options方法用来查询针对请求uri指定的资源支持的方法
- TRACE：追踪路径，用来确认连接过程中发生的一系列操作。不常用，而且容易引发XST攻击。
- CONNECT：要求用隧道协议连接代理，实现用隧道协议进行TCP通信。主要使用SSL和TLS协议把通信内容进行加密后经网络隧道传输。
4. 方法区分大小写，用大写来表示；
5. 在http协议的初始版本里，每进行一次HTTP通信就要断开一次TCP连接；为了解决TCP连接的问题，有了持久连接（http  keep-alive），也就是只要建立连接就能一次性发送请求的资源了；而管线化能做到同事并行发送多个请求，而不需要一个接一个地等待响应了，这样大大提高了效率。
6. 保留无状态协议这个特征的同时又要解决类似的矛盾问题，于是引入了cookie技术。Cookie技术通过在请求和响应报文中写入cookie信息来控制客户端的状态。
7. Cookie会根据从服务器端发送的响应报文内的一个叫做Set-Cookie的首部字段信息，通知客户端保存Cookie。当下次客户端再往服务器发送请求时，客户端会自动在请求报文中加入Cookie值后发送过去。
8. 服务端发现客户端发送过来的Cookie后，会去检查究竟是从哪一个客服端发来的连接请求，然后对比服务器上的记录，最后得到之前的状态信息。


## 第三章
1. 用于HTTP协议交互的信息被称为HTTP报文。
2. 请求端的叫请求报文，响应端的叫响应报文。
3. HTTP报文大致可分为报文首部和报文主体两块。
4. 内容编码指明应用在实体内容上的编码格式，并保持实体信息原样压缩。并由客户端负责接收和解码。
5. 常见的内容编码有以下几种：
- gzip(GNU zip)
- compress(UNIX系统的标准压缩)
- deflate(zlib)
- identity(不进行编码)
5. 在http通信的过程中，请求的编码实体资源尚未全部传输完成之前，浏览器是无法显示请求页面的。在传输大量数据时，通过把数据分割成多块，能够让浏览器逐步显示页面。
6. 分块传输编码是将实体分割成多个块。每一块都会用十六进制来标记块的大小。
7. 以前用户不能通过现在这种高速的带宽访问互联网，下载图片资源很费劲，如果下载过程中遇到网络中断的情况，那就必须重头开始。为了解决这个问题，提供了一种恢复机制，即能从之前下载中断处恢复下载。
8. 要实现上述功能需要指定下载的实体范围。指定范围发送的请求叫做范围请求(Range Request)
9. 对一份10000字节大小的资源，如果使用范围请求，可以只请求5001 ~ 10000字节内的资源。
- Range: bytes=5001-1000 请求5001-1000字节
- Range: bytes=5001- 请求5001字节之后全部的
- Range: bytes=0-3000, 5000-7000 从一开始到3000字节和5000-7000字节的多重范围
10. 针对范围请求会返回206的状态码。针对多重范围的范围请求，响应会在首部字段`Content-Type`标明`multipart/byteranges`后返回响应报文。如果服务器无法响应范围请求，则会返回状态码200 OK和完整的实体内容。
11. 同一个web网站可能存在着多份相同的内容的页面，比如中文版和英文版的。当浏览器的默认语言为英语或中文，访问相同的URI的web页面时，则会显示对应语言的页面。这样的机制称为内容协商`Content Negotiation`
12. 内容协商指客户端和服务端根据响应的资源内容进行交涉，然后提供给最为合适的资源。内容协商会以语言、字符集、编码方式等为基准进行判断。

请求报文中的如下首部字段就是判断的基准。
- Accept
- Accept-Charset
- Accept-Encoding
- Accept-Language
- Content-Language

12. 内容协商技术有以下3种类型：
- 服务器驱动协商(Server-driven Negotiation)

由服务器进行协商。以请求的首部字段作为参考，在服务器端自动处理。但对用户来说，以浏览器发送的信息作为判定的依据，并不能一定筛选出最优内容

- 客户端驱动协商(Agent-driven Negotiation)

由客户端进行协商。用户从浏览器显示的可选项列表中手动选择。还可以利用JavaScript脚本在Web页面上自动进行上述选择。比如按OS的类型或浏览器的类型，自动切换PC版页面或手机版页面。

- 透明协商(Transparent Negotiation)

是服务器驱动和客户端驱动的结合体，是由服务器端和客户端各自进行协商的一种办法。


## 第四章
1. 状态码 2xx
- 200 表示从客户端发来的请求在服务器端被正常处理了。如在使用GET请求时，对应请求资源的实体会作为响应返回。
- 204 表示服务器接收的请求已成功处理，但在返回的响应报文中不包含实体的主体部分。另外，也不允许返回任何实体的主体。

一般在只需要从客户端往服务器发送信息，而对客户端不需要发送新信息内容的情况下使用。
- 206 表示客户端进行了范围请求，而服务器成功执行了这部分的GET请求。响应报文中包含有Content-Range 指定范围的实体内容。
2. 状态码3xx。3xx响应结果表明浏览器需要执行某些特殊的处理以正确处理请求。
- 301 永久性重定向。该状态码表示请求的资源已被分配了新的URI，以后应使用资源现在所指的URI。也就是说，如果已经把资源对应的URI保存为书签了，这时应该按`location`首部字段提示的URI重新保存。
- 302 临时重定向。该状态吗表示请求的资源已被分配了新的URI，希望用户本次能使用新的URI访问。
- 303 该状态码表示由于请求对应的资源存在着另一个URI，应使用GET方法定向获取请求的资源。
- 304 表示客户端发送附带条件的请求时，服务器端允许请求访问资源，但因发生请求未满足条件的情况后，直接返回304.
- 307 临时重定向。跟302有着相同的含义。
3. 4xx客户端错误。
- 400 Bad request 表示请求报文中存在语法错误。当错误发生时，需修改请求的内容后再次发送请求。
- 401 Unauthorized 表示发送的请求需要有通过HTTP认证（BASIC认证、DIGEST认证）的认证信息。另外若之前已进行过1次请求，则表示用户认证失败。

返回含有401的响应必须包含一个适用于被请求资源的WWW-Authenticate首部用以质询用户信息。当浏览器初次接收到401响应，会弹出认证用的对话窗口
- 403 Forbidden 表明对请求资源的访问被服务器拒绝了。
- 404 Not Found 该状态码表明服务器上无法找到请求的资源，除此之外，也可以在服务器拒绝请求且不想说明理由时使用。

4. 5xx 服务器错误
- 500 Internal Server Error 表明服务器端在执行请求时发生了错误。
- 503 Service Unavailable 表明服务器暂时处于超负载或正在进行停机维护，现在无法处理请求。


## 第五章
1. 代理是一种有转发功能的应用程序，他扮演了位于服务器和客户端中间人的角色。
2. 网关是转发其他服务器通信数据的服务器。
3. 隧道是在相隔甚远的客户端和服务端两者之间进行中转，并保持双方通信连接的应用程序。

隧道的目的是确保客户端能与服务器进行安全的通信。

## 第六章
1. `Content-Type`字段表示报文主体的对象类型: `text/plain`
2. 4种HTTP首部字段类型
- **General** Header Fields **通用**首部字段
    - 请求报文和响应报文两方都会使用的首部
- **Request** Header Fields **请求首部字段**
    - 从客户端向服务器端发送请求报文时使用的首部。
- **Response** Header Fields **响应**首部字段
    - 从服务器端向客户端返回响应报文时使用的首部。
- **Entiry** Header Fields **实体**首部字段
    - 针对请求报文和响应报文的实体部分使用的首部。补充了资源内容更新时间等与实体有关的信息。
3. 通用首部字段

|首部字段名|说明|
|--|--|
|Cache-control|控制缓存的行为|
4. 通用首部字段是指，请求报文和响应报文双方都会使用的首部。
- 通过指定首部字段Cache-control的指令，就能操作缓存的工作机制 。
- 在Cache-Control中，缓存响应指令
    - public 指令 表明其他用户也可以利用缓存。
    - private指令表示以特定的用户作为对象。
    - 缓存服务器会对该特定用户提供资源缓存的服务，对于其他用户发送过来的请求，代理服务器则不会返回缓存。
    - no-cache 指令是强制向原服务器再次验证，为了防止从缓存中返回过期的资源。
        - 从服务端返回来过的带参数的no-cache，指定参数值的首部字段对应的响应报文就不能使用缓存。无参数值的首部字段可以使用缓存。
    - no-store规定缓存不能再本地储存请求或响应的任一部分。也就是不进行缓存。
    - max-age 数值代表资源保存为缓存的最长时间。
    - min-fresh 要求缓存服务器返回至少还未过指定时间的资源。超过指定的时间则无法作为响应返回。
    - max-stale 可指示缓存资源，即使过期也照样接收。
        - 指定数值，则在数值之内缓存都有效
        - 不指定数值，则无论多长时间缓存都有效。
    - only-if-cached 表示客户端仅在缓存服务器本地缓存目标存在的情况下才会要求其返回。
    - must-revalidate 代理会向源服务器再次验证即将返回的响应缓存目前是否仍然有效。
    - proxy-revalidate 指令要求所有的缓存服务器在接收到客户端带有该指令的请求返回响应之前，必须再次验证缓存的有效性。
    - no-transform 规定无论是请求还是响应中，缓存都不能改变实体主体的媒体类型。这样做可防止缓存或代理压缩图片等类似操作
- Connection 可以控制代理不再转发的首部字段。可以**管理持久连接**
    - HTTP/1.1默认连接都是持久连接（keep-alive），当服务器端想明确断开连接时，则指定Connection首部字段为`close`
- Date 表明创建HTTP报文的日期和时间。
- Trailer会事先说明在报文主体后记录了哪些首部字段。
- Transfer-Encoding 规定了传输报文主体时采用的编码方式。
- Upgrade 用于检测http协议及其他协议是否可以使用其他的通信协议
